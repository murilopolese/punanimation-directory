<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/app-layout/app-layout.html">
<link rel="import" href="../../bower_components/app-layout/demo/sample-content.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="./punani-fab.html">
<link rel="import" href="./punani-filter.html">

<dom-module id="punani-app">
    <template>
        <style is="custom-style">
            :host {
                --color-white: #FFFFFF;
                --color-black: #000000;
                --color-grey: #EDEDED;
                --color-yellow: #FCC438;
                display: block;
                font-family: 'Open Sans';
                font-size: 12px;
            }
            a:link,
            a:visited,
            a:active,
            a:hover {
                color: var(--color-black);
                text-decoration: none;
            }
            #drawerMenu {
                z-index: 30;
                --app-drawer-content-container: {
                    box-shadow: 1px 0 2px 1px rgba(0,0,0,0.18);
                }
            }
            app-header {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                background-color: var(--color-grey);
                color: var(--color-black);
                z-index: 10;
            }
            app-header paper-icon-button {
                --paper-icon-button-ink-color: var(--color-black);
            }
            .container {
                display: block;
                position: relative;
                max-width: 960px;
                margin: 0 auto;
                padding: 0 20px;
                z-index: 0;
            }

            #header-top {
                height: 160px;
                width: 100%;
            }

            #navigation,
            #social-media {
                position: absolute;
                top: 15px;
            }
            #social-media {
                right: 20px;
            }
            #navigation {
                left: 20px;
            }
            #navigation .item {
                font-weight: 600;
                font-size: 12px;
                letter-spacing: 0.15em;
                margin-right: 20px;
            }

            #title {
                @apply --layout-vertical;
                @apply --layout-center;
                @apply --layout-center-justified;
                height: 100%;
                text-align: center;
            }
            #title .logo {
                width: 130px;
                margin-bottom: 10px;
            }
            #title .description {
                letter-spacing: 0.07em;
            }

            #filters .col {
                margin: 10px 0 15px 0;
            }

            #feed {
                padding-top: 220px;
            }
            #feed .image {
                width: 100%;
                height: auto;
                max-width: 100%;
                border: solid 1px var(--color-black);
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
            }
            #feed .col {
                @apply --layout-vertical;
                @apply --layout-center;
                text-align: center;
                margin: 10px 0 10px 0;
            }
            #feed .name {
                display: inline-block;
                margin-top: 6px;
                font-weight: 900;
                font-size: 12px;
                letter-spacing: 0.1em;
                text-transform: uppercase;
            }
            #feed .location {
                display: inline-block;
                font-size: 10px;
                letter-spacing: 0.2em;
                margin-left: 4px;
            }

            .dialog {
                font-family: 'Open Sans';
                font-size: 12px;
                width: 500px;
                background: var(--color-yellow);
                box-shadow: var(--shadow-elevation-2dp_-_box-shadow);
            }
            .dialog .name {
                font-size: 16px;
                font-weight: 800;
                letter-spacing: 0.03em;
                text-transform: uppercase;
            }
            .dialog .title {
                font-size: 14px;
                font-weight: 800;
                letter-spacing: 0.03em;
                text-transform: uppercase;
                margin-top: 0.8em;
                line-height: 0.8em;
            }
            .dialog .link {
                float: right;
                --punani-fab-size: 25px;
                --punani-fab-padding: 0px;
                --punani-fab-ripple-color: var(--color-white);
            }

            .row {
                @apply --layout-horizontal;
                @apply --layout-justified;
                @apply --layout-wrap;
            }
            .row .col {
                width: calc(33% - 20px);
                padding: 0 10px;
            }

            .hide-desktop {
                display: none;
            }
            @media (max-width: 768px) {
                .hide-mobile {
                    display: none;
                }
                .hide-desktop {
                    display: inherit;
                }
                #header-top {
                    height: 200px;
                }
                #feed {
                    padding-top: 360px;
                }
                #filters .col {
                    margin: 5px 0;
                }
                #filters .col:last-child {
                    margin-bottom: 15px;
                }
                .row {
                    @apply --layout-vertical;
                }
                .row .col {
                    padding: 0;
                    width: 100%;
                    max-width: none;
                }
                .dialog {
                    width: 100%;
                    margin: 24px 20px;
                }
            }
        </style>
        <app-header condenses reveals>
            <div id="header-top">
                <div class="container" style="height: 100%;">
                    <div id="navigation">
                        <div class="hide-mobile">
                            <a class="item" href="#">About</a>
                            <a class="item" href="#">Join</a>
                        </div>
                        <div class="hide-desktop">
                            <paper-icon-button
                                icon="menu"
                                on-tap="toggleMenu">
                            </paper-icon-button>
                        </div>
                    </div>
                    <div id="title">
                        <iron-image
                            class="logo"
                            src="/assets/logo.svg" alt="">
                        </iron-image>
                        <div class="description">
                            A directory of women, trans and non-binary people
                            working with animation and motion graphics.
                        </div>
                    </div>
                    <div id="social-media">
                        <div class="hide-mobile">
                            <a href="#">
                                <punani-fab>
                                    <iron-image
                                        src="/assets/facebook.svg"
                                        width="30"
                                        alt="">
                                    </iron-image>
                                </punani-fab>
                            </a>
                            <a href="#">
                                <punani-fab>
                                    <iron-image
                                        src="/assets/vimeo.svg"
                                        width="30"
                                        alt="">
                                    </iron-image>
                                </punani-fab>
                            </a>
                            <a href="#">
                                <punani-fab>
                                    <iron-image
                                        src="/assets/instagram.svg"
                                        width="30"
                                        alt="">
                                    </iron-image>
                                </punani-fab>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container" sticky>
                <div id="filters" class="row">
                    <div class="col">
                        <punani-filter
                            id="locationFilter"
                            items="[[locations]]"
                            is-hidden="{{locationHidden}}"
                            label="Location">
                        </punani-filter>
                    </div>
                    <div class="col">
                        <punani-filter
                            id="skillsFilter"
                            items="[[skills]]"
                            extra-label="Extra Skills"
                            is-hidden="{{skillsHidden}}"
                            label="Skills">
                        </punani-filter>
                    </div>
                    <div class="col">
                        <punani-filter
                            id="softwaresFilter"
                            items="[[softwares]]"
                            is-hidden="{{softwaresHidden}}"
                            label="Softwares">
                        </punani-filter>
                    </div>
                </div>
            </div>
        </app-header>

        <div id="feed" class="container">
            <div class="row">
                <template is="dom-repeat" items="[[punanis]]">
                    <div class="col">
                        <a href="#" on-tap="openDialog">
                            <img class="image" src$="[[item.image]]" />
                            <span class="name">
                                [[item.name]]
                            </span>
                            <span class="location">
                                ([[item.location.label]])
                            </span>
                        </a>
                    </div>
                </template>
            </div>
        </div>

        <template is="dom-repeat" items="[[punanis]]">
            <paper-dialog id$="dialog-[[item.id]]" class="dialog" with-backdrop>
                <div>
                    <div class="name">
                        [[item.name]]
                        <a href$="[[item.link]]" target="_blank">
                            <punani-fab class="link">
                                    <iron-image
                                    src="/assets/link02.svg"
                                    width="60"
                                    alt="">
                                </iron-image>
                            </punani-fab>
                        </a>
                    </div>
                    <div class="location">
                        <span>[[item.location.label]]</span>
                    </div>
                    <div class="title">SKILLS</div>
                    <div>
                        <template is="dom-repeat" items="[[item.skills]]" as="skill">
                            <span>[[skill.label]]</span><span hidden$="[[_lastItem(index, item.skills)]]">,</span><span hidden$="[[!_lastItem(index, item.skills)]]">.</span>
                        </template>
                    </div>
                    <div class="title">EXTRA SKILLS</div>
                    <div>
                        <template is="dom-repeat" items="[[item.skills]]" as="skill">
                            <span>[[skill.label]]</span><span hidden$="[[_lastItem(index, item.skills)]]">,</span><span hidden$="[[!_lastItem(index, item.skills)]]">.</span>
                        </template>
                    </div>
                    <div class="title">SOFTWARES</div>
                    <div>
                        <template is="dom-repeat" items="[[item.softwares]]" as="softwares">
                            <span>[[softwares.label]]</span><span hidden$="[[_lastItem(index, item.softwares)]]">,</span><span hidden$="[[!_lastItem(index, item.softwares)]]">.</span>
                        </template>
                    </div>
                </div>
            </paper-dialog>
        </template>

        <app-drawer id="drawerMenu" align="start">
            <div>
                <a href="#">About</a>
            </div>
            <div>
                <a href="#">Join</a>
            </div>
            <div>
                <a href="#">
                    <punani-fab>
                        <iron-image
                            src="/assets/facebook.svg"
                            width="30"
                            alt="">
                        </iron-image>
                    </punani-fab>
                </a>
                <a href="#">
                    <punani-fab>
                        <iron-image
                            src="/assets/vimeo.svg"
                            width="30"
                            alt="">
                        </iron-image>
                    </punani-fab>
                </a>
                <a href="#">
                    <punani-fab>
                        <iron-image
                            src="/assets/instagram.svg"
                            width="30"
                            alt="">
                        </iron-image>
                    </punani-fab>
                </a>
            </div>
        </app-drawer>

    </template>

    <script>
    /**
    * @customElement
    * @polymer
    */
    class PunaniApp extends Polymer.GestureEventListeners(Polymer.Element) {
        static get is() { return 'punani-app'; }
        static get properties() {
            return {
                locationHidden: {
                    type: Boolean,
                    value: true,
                    notify: true
                },
                skillsHidden: {
                    type: Boolean,
                    value: true,
                    notify: true
                },
                softwaresHidden: {
                    type: Boolean,
                    value: true,
                    notify: true
                },
                locations: {
                    type: Array,
                    value: () => {
                        return [
                            { name: 'london_uk', label: 'London, UK' },
                            { name: 'stockholm_se', label: 'Stockholm, SE' }
                        ];
                    }
                },
                skills: {
                    type: Array,
                    value: () => {
                        return [
                            { name:'2d-animation', label: '2D Animation' },
                            { name:'2d-effects', label: '2D Effects' },
                            { name:'2d-rigging', label: '2D Rigging' },
                            { name:'3d-animation', label: '3D Animation' },
                            { name:'3d-effects', label: '3D Effects' },
                            { name:'3d-rigging', label: '3D Rigging' },
                            { name:'3d-modeling', label: '3D Modeling / Texturing' },
                            { name:'motion-graphics', label: 'Motion Graphics' },
                            { name:'other-skill-1', label: 'Other Skill' },
                            { name:'teaching', label: 'Teaching / Mentoring', extra: true },
                            { name:'public-speaking', label: 'Public Speaking', extra: true }
                        ];
                    }
                },
                softwares: {
                    type: Array,
                    value: () => {
                        return [
                            { name: 'illustrator', label: 'Illustrator' },
                            { name: 'photoshop', label: 'Photoshop' }
                        ];
                    }
                },
                punanis: {
                    type: Array,
                    value: () => {
                        let people = [];
                        for (let i = 0; i < 60; i++) {
                            people.push(
                                {
                                    id: 'id' + i,
                                    name: 'Bee Grandinetti ' + i,
                                    image: 'https://media2.giphy.com/media/xUOwGd2sXd4VwJ0Y48/giphy.gif',
                                    link: 'https://beegrandinetti.com',
                                    skills: [
                                        { name: '2d_animation', label: '2D Animation' },
                                        { name: 'motion_graphics', label: 'Motion Graphics' },
                                        { name: 'teaching', label: 'Teaching', extra: true },
                                        { name: 'mentoring', label: 'Mentoring', extra: true }
                                    ],
                                    softwares: [
                                        { name: 'illustrator', label: 'Illustrator' },
                                        { name: 'photoshop', label: 'Photoshop' }
                                    ],
                                    location: {
                                        name: 'london', label: 'London, UK'
                                    }
                                }
                            );
                        }
                        return people;
                    }
                }
            };
        }
        connectedCallback() {
            super.connectedCallback();
            this.addEventListener('click', this.hideOptions.bind(this), false);
            this.addEventListener('tap', this.hideOptions.bind(this), false);
            window.addEventListener('scroll', this.hideOptions.bind(this), false);
        }
        toggleMenu(e) {
            this.$.drawerMenu.toggle();
        }
        hideOptions(e) {
            if (!e.path) {
                // Screw you, Safari
                if (!this.$.locationFilter.isHidden) {
                    this.$.skillsFilter.set('isHidden', true);
                    this.$.softwaresFilter.set('isHidden', true);
                }
                if (!this.$.skillsFilter.isHidden) {
                    this.$.locationFilter.set('isHidden', true);
                    this.$.softwaresFilter.set('isHidden', true);
                }
                if (!this.$.softwaresFilter.isHidden) {
                    this.$.locationFilter.set('isHidden', true);
                    this.$.skillsFilter.set('isHidden', true);
                }
                // if (e.type === 'scroll') {
                //     this.$.locationFilter.set('isHidden', true);
                //     this.$.skillsFilter.set('isHidden', true);
                //     this.$.softwaresFilter.set('isHidden', true);
                // }
                return;
            }
            const filterElement = e.path.find((el) => {
                return el && el.tagName && el.tagName.toLowerCase() == 'punani-filter';
            });
            if (!filterElement) {
                this.$.locationFilter.set('isHidden', true);
                this.$.skillsFilter.set('isHidden', true);
                this.$.softwaresFilter.set('isHidden', true);
            } else {
                if (filterElement.id == 'locationFilter' && !filterElement.isHidden) {
                    this.$.skillsFilter.set('isHidden', true);
                    this.$.softwaresFilter.set('isHidden', true);
                }
                if (filterElement.id == 'skillsFilter' && !filterElement.isHidden) {
                    this.$.locationFilter.set('isHidden', true);
                    this.$.softwaresFilter.set('isHidden', true);
                }
                if (filterElement.id == 'softwaresFilter' && !filterElement.isHidden) {
                    this.$.locationFilter.set('isHidden', true);
                    this.$.skillsFilter.set('isHidden', true);
                }
            }
        }
        openDialog (e) {
            e.preventDefault();
            console.log(e);
            const item = e.model.item;
            const dialog = Polymer.dom(this.root).querySelector(`#dialog-${item.id}`);
            if (dialog) {
                dialog.open();
            }
            return false;
        }
        _lastItem (index, items) {
            return items.length-1 === index;
        }
    }

    window.customElements.define(PunaniApp.is, PunaniApp);
    </script>
</dom-module>
